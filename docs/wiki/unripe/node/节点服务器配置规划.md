# 节点服务器配置规划

本节介绍与扩展“skywelld”服务器以进行测试和生产部署相关的一些实验 。此外，它还描述了硬件和配置设置如何与这些实验相关联。最后，本节提供了一些建议，可帮助您正确设置“skywelld”以满足部署用例的目标。

即使功能最小的`skywelld`服务器也必须包含最近验证的分类帐版本，以便向网络提交事务并验证SWTC Ledger的完整性。除了这些要求，请考虑以下可能的业务需求：

- 处理不断增加的交易量
- 向客户提供交易报告信息
- 维护不同数量的历史数据

要满足您的“skywelld”配置要求，您必须解决以下技术因素：

- 影响资源利用率的配置设置
- 良好性能的[网络和硬件]要求，使本节点服务器账本在SWTC Ledger网络中实现同步一致

## 配置设置

skywelld建议使用以下指南来提高性能。您可以在`skywelld.cfg`文件中设置以下参数，以提高`skywelld`服务器的性能。

### 节点大小

`node_size`参数确定数据库缓存的大小。较大的数据库缓存以较高的内存要求为代价降低了磁盘I / O要求。 建议您始终使用可用内存可以支持的最大数据库缓存。有关建议的设置，请参阅下表。

#### 推荐

| skywelld 可用的RAM | `node_size` value | Notes                              |
|:----------------------------|:------------------|:-----------------------------------|
| < 8GB                       | `tiny`            | 	不建议                   |
| 8GB                         | `small`           |                                    |
| 16GB                        | `medium`          |                                    |
| 32GB                        | `huge`            | 推荐用于生产服务器 servers |


### 节点数据库类型

`skywelld.cfg`文件的`node_db`部分中的`type`字段设置了`skywelld`用于在分类帐存储中保留SWTC Ledger的键值存储的类型。您可以将值设置为`rocksdb`或`nudb`。

`skywelld`提供历史分片功能，允许您将随机范围的分类帐存储在单独的分片存储中。您可能希望将分片存储配置为使用与分类帐存储不同类型的键值存储。有关如何使用此功能的更多信息，请参阅[历史分片]。

#### RocksDB vs NuDB
RocksDB比NuDB少占磁盘存储量的三分之一，并且I / O延迟也相应提高。但是，随着存储容量的增加，这会增加内存利用率。另一方面，NuDB具有几乎恒定的性能和内存占用，无论存储如何。

作为验证器运行的`skywelld`服务器应该只保留几天或更少的数据。 建议使用RocksDB进行验证。对于所有其他用途，建议将NuDB用于分类帐存储。

RocksDB具有与性能相关的配置选项，您可以修改它们以实现最大的事务处理吞吐量。 （NuDB没有与性能相关的配置选项。）以下是使用RocksDB的“skywelld”服务器的推荐配置示例：

```
[node_db]
type=rocksdb
open_files=512
file_size_mb=64
file_size_mult=2
filter_bits=12
cache_mb=512
path={path_to_ledger_store}
```

### 历史数据

“skywelld”服务器保持联机的历史数据量是所需存储空间的主要贡献者。随着SWTC Ledger网络中事务量的增加，您可以预期此数量会增加。您可以使用`online_delete`和`advisory_delete`字段控制您保留的数据量。

在线删除可以从数据库中修剪“skywelld”分类帐，而不会中断服务。它仅删除不属于当前分类帐的记录。没有在线删除，这些数据库无限制地增长。释放磁盘空间需要停止进程并手动删除数据库文件。


### 日志级别

默认的`skywelld.cfg`文件将日志记录详细程度设置为`warning`。此设置大大减少了磁盘空间和I / O要求，而不是更详细的日志记录。但是，更详细的日志记录可提高故障排除的可见性。

**注意**：如果省略`[rpc_startup]`节中的`log_level`命令，`skywelld`会在`debug`级别将日志写入磁盘，并将`warning`级别日志输出到控制台。 `debug`级别日志记录每天需要比`warning`级别多几GB的磁盘空间，具体取决于事务卷和客户端活动。

## 网络和硬件

SWTC Ledger网络中的每个skywelld服务器都执行网络的所有事务处理工作。卷何时接近最大网络容量尚不得而知。因此，生产skywelld服务器的基线硬件应与性能测试中使用的类似。

### 推荐

为了在企业生产环境中获得最佳性能，建议在裸机上运行“skywelld”，具有以下特征：

- 操作系统：Ubuntu 16.04+
- CPU：Intel Xeon 3+ GHz处理器，支持4核和超线程
- 磁盘：SSD
- 内存：
- 测试：8GB +
- 适用于生产：32GB
- 网络：主机上具有千兆网络接口的企业数据中心网络

#### SSD存储

SSD存储应支持数千个读写IOPS。 工程师观察到的每秒最大读取和写入次数超过每秒10,000次读取（在频繁使用的公共服务器群集中），每秒超过7,000次写入（在专用性能测试中）。

#### CPU利用率和虚拟化
skywelld性能工程已确定裸机服务器可实现最大吞吐量。但是，管理程序可能会导致性能降低最小化。

#### 网络

任何企业或运营商级数据中心都应具有足够的网络带宽，以支持运行“skywelld”服务器。对于当前事务量，最低要求大约为2Mbps传输和2Mbps接收。但是，在提供历史分类帐和交易报告时，这些可以突发高达100MBps的传输。当`skywelld`服务器最初启动时，它可以突发到超过20Mbps的接收。

#### 存储

每天的数据会随着网络中的活动而变化增加。您应该提供额外的容量来为未来的增长做好准备。。

#### 内存

内存要求主要是`node_size`配置设置和检索历史数据的客户端流量的函数。如前所述，生产服务器应该最大化性能并将此参数设置为“huge”。
您可以将`node_size`参数设置为较低以使用较少的内存，但您只应执行此操作以进行测试。使用`medium_size`为`medium`，一个`skywelld`服务器在一个只有8GB RAM的测试Linux系统中可以相当稳定。

