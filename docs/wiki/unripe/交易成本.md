# 交易成本

为了保护SWTC Ledger免受垃圾邮件和拒绝服务攻击的干扰，每个事务必须销毁少量[SWTC]。旨在随着网络负载的增加而增加，使得故意或无意中使网络过载非常昂贵。

每个事务必须[指定要销毁多少SWTC]来支付交易成本。


## 当前交易成本

网络对标准交易所需的当前最低交易成本是 **0.00001 SWTC**。它有时会因高于正常负载而增加。

您还可以[查询`skywelld`获取当前交易成本]。

### 特殊交易成本

某些交易有不同的交易成本：

|交易|负载扩展前的成本|
| ----------------------- | -------------------------|
| [参考交易]（大多数交易）| 0.00001 SWTC |
| [密钥重置事务]| 0 |
| [多重签名交易]| 0.00001 SWTC ×（1 +签名数）|
| [EscrowFinish交易与履行]| 0.00001 SWTC ×（33 +（以字节为单位的实现大小÷16））|


## 交易成本的受益人

交易成本不支付给任何一方：SWTC不可撤销地被销毁。由于不能创建新的SWTC，这使得SWTC更加稀缺，并使SWTC更有价值，从而使所有SWTC持有者受益。


## 加载成本和开立分类帐成本


当启用[FeeEscalation修订]时，交易成本有两个阈值：

* 如果交易成本不符合“skywelld”服务器的[基于负载的交易成本阈值]，则服务器完全忽略该交易。 （无论有没有修正，这个逻辑基本上都没有改变。）
* 如果交易成本不符合“skywelld”服务器的[开放式分类帐成本阈值]，则服务器将事务排队等待后续分类帐。

这将交易分为大致三类：

* 指定交易成本如此之低以至于被基于负载的交易成本拒绝的交易。
* 指定交易成本高到足以包含在当前未结分类帐中的交易。
* 之间的交易，其中[排队等待后来的分类帐版本]。


## 本地负载成本

每个`skywelld`服务器根据其当前负载维护成本阈值。如果您提交的事务的“费用”值低于“skywelld”服务器的当前基于负载的交易成本，则该服务器既不会应用也不会中继该事务。 （**注意：**如果您通过[管理连接]提交交易，只要交易符合以下条件，服务器就会应用并转发交易规模最小交易成本。）交易不太可能存活[共识流程]，除非其“费用”价值符合多数人的要求服务器。

## 开立分类帐成本

`skywelld`服务器有第二种机制来强制执行交易成本，被称为第二机构账本的成本。如果交易符合SWTC中的开放式分类帐成本要求，则该交易只能包含在开放式分类帐中。不符合开放式分类帐成本的交易可以[排队等待下一个分类帐]。

对于每个新的分类帐版本，服务器根据前一个分类帐中的事务数量选择要包含在开放分类帐中的事务数量的软限制。开放式分类帐成本等于最小未缩放交易成本，直到开放式分类帐中的交易数等于软限制。之后，开放式分类帐中包含的每个交易的开放式分类帐成本呈指数级增长。对于下一个分类帐，如果当前分类帐包含的事务数多于软限制，则服务器会增加软限制，如果共识过程需要超过5秒，则会降低软限制。

开放式分类账成本要求[与交易的正常成本成比例]，而不是绝对交易成本。具有高于正常要求的交易类型（例如[多签名交易]）必须支付更多费用以满足开放分类帐成本，而不是具有最低交易成本要求的交易。


### 排队交易

当`skywelld`收到满足服务器本地负载成本而不是[开放式分类帐成本]的事务时，服务器会估计该事务是否“可能包含在后续分类帐中”。如果是，则服务器将事务添加到事务队列并将事务中继到网络的其他成员。否则，服务器会丢弃该事务。服务器尝试最小化由不支付交易成本的交易引起的网络负载量，因为[交易成本仅在交易包含在经过验证的分类帐中时适用] 。

当前打开的分类帐关闭且服务器启动新的开放分类帐时，服务器开始从队列中获取事务以包含在新的开放分类帐中。事务队列使用首先支付最高交易成本的交易进行排序，与这些交易的[参考成本]成比例。支付相同交易成本的交易按服务器接收的顺序排队。

**注意**：当`skywelld`对一个事务进行排队时，临时交易响应代码是terQUEUED。这意味着该交易很可能在未来的分类帐版本中取得成功。与所有临时响应代码一样，在事务包含在已验证的分类帐中或永久无效之前，事务的结果不是最终的。

#### 排队限制

`skywelld`服务器使用各种启发式方法来估计哪些交易“可能包含在分类帐中”。当前实现使用以下规则来确定要排队的事务：

* 必须使用有效签名正确形成和[授权]交易。
* 具有“AccountTxnID”字段的事务无法排队。
* 单个发送地址最多可同时排队10个事务。为了使事务排队，发送方必须具有足够的SWTC来支付所有发送方的排队事务的所有SWTC成本，包括“费用”字段和每个事务可以发送的SWTC的总和。
* 如果事务影响发送地址授权事务的方式，则同一地址的其他事务不能排在其后。
* 如果交易包含“LastLedgerSequence”字段，则该字段的值必须至少为**当前分类帐索引+ 2 **。

#### 费用平均

如果发送地址有一个或多个排队的事务，则该发送方可以通过提交具有足够高的交易成本的新交易来“支持”现有的排队交易到开放分类帐中以支付所有这些交易。具体而言，新事务必须增加来自相同发送地址（包括新事务）的排队事务的总事务成本，以覆盖每个事务添加到的每个事务的[开放分类帐成本]分类帐。总额必须包括每笔新交易增加的未结分类账成本。事务必须仍然遵循其他[排队限制]，并且发送地址必须具有足够的SWTC来支付所有排队事务的事务成本。

此功能可帮助您解决特定情况。如果您提交了一个或多个已排队的低成本事务，则除非您执行以下操作之一，否则无法从同一地址发送新事务：

* 等待排队的事务包含在经过验证的分类帐中。
* 如果事务已设置LastLedgerSequence字段，则等待排队的事务永久失效。
* 通过提交具有相同序列号的新事务来取消排队的事务。

如果没有上述情况发生，交易可以在理论上无限期地保留在队列中，而其他交易发起人可以通过提交具有较高交易成本的交易来“插队”。由于已签名的事务是不可变的，因此无法增加排队事务的事务成本以提高其优先级。如果您不想使先前提交的交易无效，则费用平均可提供解决方法。如果您增加新交易的交易成本以进行补偿，则可以确保排队的交易立即包含在开放式分类帐中。

## 参考交易成本

就负载扩展前的必要交易成本而言，“参考交易”是最便宜的（非免费）交易。大多数交易的成本与参考交易相同。某些交易（例如多签名交易）需要此费用的倍数。当开放式分类帐成本上升时，需求与交易的基本成本成比例。

### 费用等级

_Fee levels_表示最低成本与交易实际成本之间的比例差异。 [开放式分类帐成本]以费用级别而非绝对成本来衡量。请参阅下表进行比较：

|交易|交易最低成本|费用水平的最低费用|交易双倍成本|费用水平双倍费用|
| ------------- | ----------------- | ----------------- | ----------------- | ----------------- |
|参考交易（大多数交易）| 0.00001 | 0.000256 | 0.00002 | 0.000512 |
| [多签名交易]（multi-signing.html）有4个签名| 0.00005 | 0.000256 | 0.0001 | 0.000512 |
| [密钥重置事务]（transaction-cost.html＃key-reset-transaction）| 0 | （实际上是无限的）| N / A | （实际上是无限的）|
| [EscrowFinish transaction]（escrowfinish.html），带有32字节的preimage。 | 0.00035 | 0.000256 | 0.0007 | 0.000512 |


## 查询交易成本

`skywelld` API有两种方法来查询本地基于负载的事务成本：`server_info`命令（所有连接用户都能使用）和`server_state`命令（本机管理员使用）。

如果启用了[费用提升修正]，您可以使用[费用方法] []检查未结分类帐成本。

### server_info

[server_info method] []以十进制SWTC的形式将未缩放的最小SWTC成本（从前一个分类帐）报告为“validated_ledger.base_fee_swtc”。中继事务所需的实际成本是通过将`base_fee_swtc`值乘以同一响应中的`load_factor`参数来缩放的，该参数表示服务器的当前负载级别。换一种说法：

**SWTC中的当前交易成本=`base_fee_swtc`×`load_factor`**


### server_state

[server_state方法] []返回`skywelld`的内部负载计算的直接表示。在这种情况下，有效负载率是当前`load_factor`与`load_base`的比率。 `validated_ledger.base_fee`参数报告SWTC丢弃的最小事务成本。这种设计使`skywelld`能够仅使用整数数学来计算交易成本，同时仍允许对服务器负载进行合理的微调。交易成本的实际计算如下：

**Drops中的当前交易成本=（`base_fee`×`load_factor`）÷`load_base`**

## 指定交易成本

每个签名的交易必须包括该Fee字段中的交易成本。与已签名事务的所有字段一样，如果不使签名无效，则无法更改此字段。

通常，SWTC Ledger 完全按照签名执行事务。（至少在分散的共识网络中，做任何其他事情很难协调。）因此，每个事务都会破坏Fee字段指定的SWTC的确切数量，即使指定的数量远远超过网络任何部分的当前最低交易成本。交易成本甚至可以破坏SWTC，否则SWTC将被留出来用于账户的保留要求。

在签署交易之前，我们建议您查找当前基于负载的交易成本。如果由于负载扩展导致交易成本很高，您可能希望等待它减少。如果您不打算立即提交交易，我们建议您指定稍高的交易成本，以考虑交易成本中未来基于负载的波动。


### 自动指定交易成本

在线签署交易时，可以省略该Fee字段。在这种情况下，skywelld或者skywelldAPI检查对等网络的状态以获取当前需求，并Fee在签署事务之前添加值。但是，以这种方式自动填写交易成本有几个缺点和限制：

* 如果在签署和分发交易之间网络的交易成本上升，则可能无法确认交易。
    * 在最坏的情况下，交易可能会陷入既未明确确认也不会被拒绝的状态，除非它包含一个`LastLedgerSequence`参数，或者直到你用一个使用相同`Sequence`数字的新事务取消它。
* 您事先并不知道您为Fee字段签署的确切值。
    * 如果你使用`skywelld`，你也可以使用[sign method] []的`fee_mult_max`和`fee_div_max`参数来设置你愿意签名的负载扩展的限制。
* 您无法从离线计算机中查找当前的交易成本。
* [多签名]时，您无法自动指定交易成本。

## 交易成本和失败的交易

由于交易成本的目的是保护SWTC Ledger对等网络免受过度负载，因此它应该适用于分发到网络的任何事务，无论该事务是否成功。但是，要影响共享全局分类帐，事务必须包含在已验证的分类帐中。因此，skywelld服务器尝试在分类账中包含失败的交易，tec状态代码（“tec”代表“交易引擎 - 仅声明的费用”）。

当交易实际包含在经过验证的分类帐中时，交易成本仅从发起人的SWTC余额中扣除。无论事务被认为是成功还是使用`tec`代码失败都是如此。

如果事务最终失败，那么`skywelld`服务器不会将其转发到网络。交易未包含在经过验证的分类帐中，因此不会对任何人的SWTC余额产生任何影响。

### SWTC不足

当`skywelld`服务器最初评估事务时，如果发送帐户没有足够高的SWTC余额来支付SWTC事务成本，它将拒绝具有错误代码`terINSUF_FEE_B`的事务。由于这是一个`ter`（重试）代码，`skywelld`服务器重试事务而不将其转发到网络，直到事务的最终结果。

当一个事务已经分发到网络，但是该帐户没有足够的SWTC来支付交易成本时，会发生结果代码`tecINSUFF_FEE`。在这种情况下，帐户支付所有可能的SWTC，以0 SWTC结束。这可能是因为`skywelld`决定是否根据正在进行的分类帐将事务中继到网络，但是在构建共识分类帐时可能会丢弃或重新排序事务。


## 密钥重置交易

作为一种特殊情况，只要帐户的lsfPasswordSpent标志被禁用，帐户就可以发送事务成本为的SetRegularKey事务。此交易必须由帐户的主密钥对签名。发送此事务将启用lsfPasswordSpent标志。0

此功能旨在允许您在常规密钥被泄露时恢复帐户，而不必担心受感染的帐户是否有任何可用的SWTC。这样，您可以在向其发送更多SWTC之前重新获得对帐户的控制权。

该lsfPasswordSpent标志开始时禁用。当您发送由主密钥对签名的SetRegularKey事务时，它将启用。当帐户收到SWTC付款时，它会再次被禁用。

当启用FeeEscalation修订时，skywelld即使密钥重置事务的标称交易成本为零，也将密钥重置事务优先于其他事务。


## 更改交易成本

SWTC Ledger具有一种机制，用于更改最小交易成本以考虑XRP值的长期变化。任何变更都必须得到共识流程的批准。

